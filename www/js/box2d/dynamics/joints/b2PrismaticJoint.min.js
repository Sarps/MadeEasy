var b2PrismaticJoint=Class.create();Object.extend(b2PrismaticJoint.prototype,b2Joint.prototype),Object.extend(b2PrismaticJoint.prototype,{GetAnchor1:function(){var i=this.m_body1,t=new b2Vec2;return t.SetV(this.m_localAnchor1),t.MulM(i.m_R),t.Add(i.m_position),t},GetAnchor2:function(){var i=this.m_body2,t=new b2Vec2;return t.SetV(this.m_localAnchor2),t.MulM(i.m_R),t.Add(i.m_position),t},GetJointTranslation:function(){var i,t=this.m_body1,o=this.m_body2;i=t.m_R;var l=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,m=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=o.m_R;var a=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,n=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,s=t.m_position.x+l,_=t.m_position.y+m,e=o.m_position.x+a,r=o.m_position.y+n,c=e-s,h=r-_;i=t.m_R;var b=i.col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y,y=i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y,x=b*c+y*h;return x},GetJointSpeed:function(){var i,t=this.m_body1,o=this.m_body2;i=t.m_R;var l=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,m=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=o.m_R;var a=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,n=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,s=t.m_position.x+l,_=t.m_position.y+m,e=o.m_position.x+a,r=o.m_position.y+n,c=e-s,h=r-_;i=t.m_R;var b=i.col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y,y=i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y,x=t.m_linearVelocity,u=o.m_linearVelocity,p=t.m_angularVelocity,A=o.m_angularVelocity,J=c*-p*y+h*p*b+(b*(u.x+-A*n-x.x- -p*m)+y*(u.y+A*a-x.y-p*l));return J},GetMotorForce:function(i){return i*this.m_motorImpulse},SetMotorSpeed:function(i){this.m_motorSpeed=i},SetMotorForce:function(i){this.m_maxMotorForce=i},GetReactionForce:function(i){var t,o=i*this.m_limitImpulse;t=this.m_body1.m_R;var l=o*(t.col1.x*this.m_localXAxis1.x+t.col2.x*this.m_localXAxis1.y),m=o*(t.col1.y*this.m_localXAxis1.x+t.col2.y*this.m_localXAxis1.y),a=o*(t.col1.x*this.m_localYAxis1.x+t.col2.x*this.m_localYAxis1.y),n=o*(t.col1.y*this.m_localYAxis1.x+t.col2.y*this.m_localYAxis1.y);return new b2Vec2(l+a,m+n)},GetReactionTorque:function(i){return i*this.m_angularImpulse},initialize:function(i){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=i.type,this.m_prev=null,this.m_next=null,this.m_body1=i.body1,this.m_body2=i.body2,this.m_collideConnected=i.collideConnected,this.m_islandFlag=!1,this.m_userData=i.userData,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_linearJacobian=new b2Jacobian,this.m_motorJacobian=new b2Jacobian;var t,o,l;t=this.m_body1.m_R,o=i.anchorPoint.x-this.m_body1.m_position.x,l=i.anchorPoint.y-this.m_body1.m_position.y,this.m_localAnchor1.Set(o*t.col1.x+l*t.col1.y,o*t.col2.x+l*t.col2.y),t=this.m_body2.m_R,o=i.anchorPoint.x-this.m_body2.m_position.x,l=i.anchorPoint.y-this.m_body2.m_position.y,this.m_localAnchor2.Set(o*t.col1.x+l*t.col1.y,o*t.col2.x+l*t.col2.y),t=this.m_body1.m_R,o=i.axis.x,l=i.axis.y,this.m_localXAxis1.Set(o*t.col1.x+l*t.col1.y,o*t.col2.x+l*t.col2.y),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_initialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation,this.m_linearJacobian.SetZero(),this.m_linearMass=0,this.m_linearImpulse=0,this.m_angularMass=0,this.m_angularImpulse=0,this.m_motorJacobian.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_limitImpulse=0,this.m_limitPositionImpulse=0,this.m_lowerTranslation=i.lowerTranslation,this.m_upperTranslation=i.upperTranslation,this.m_maxMotorForce=i.motorForce,this.m_motorSpeed=i.motorSpeed,this.m_enableLimit=i.enableLimit,this.m_enableMotor=i.enableMotor},PrepareVelocitySolver:function(){var i,t=this.m_body1,o=this.m_body2;i=t.m_R;var l=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,m=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=o.m_R;var a=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,n=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,s=t.m_invMass,_=o.m_invMass,e=t.m_invI,r=o.m_invI;i=t.m_R;var c=i.col1.x*this.m_localYAxis1.x+i.col2.x*this.m_localYAxis1.y,h=i.col1.y*this.m_localYAxis1.x+i.col2.y*this.m_localYAxis1.y,b=o.m_position.x+a-t.m_position.x,y=o.m_position.y+n-t.m_position.y;if(this.m_linearJacobian.linear1.x=-c,this.m_linearJacobian.linear1.y=-h,this.m_linearJacobian.linear2.x=c,this.m_linearJacobian.linear2.y=h,this.m_linearJacobian.angular1=-(b*h-y*c),this.m_linearJacobian.angular2=a*h-n*c,this.m_linearMass=s+e*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+_+r*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2,this.m_linearMass=1/this.m_linearMass,this.m_angularMass=1/(e+r),this.m_enableLimit||this.m_enableMotor){i=t.m_R;var x=i.col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y,u=i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y;if(this.m_motorJacobian.linear1.x=-x,this.m_motorJacobian.linear1.y=-u,this.m_motorJacobian.linear2.x=x,this.m_motorJacobian.linear2.y=u,this.m_motorJacobian.angular1=-(b*u-y*x),this.m_motorJacobian.angular2=a*u-n*x,this.m_motorMass=s+e*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+_+r*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2,this.m_motorMass=1/this.m_motorMass,this.m_enableLimit){var p=b-l,A=y-m,J=x*p+u*A;b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:J<=this.m_lowerTranslation?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atLowerLimit):J>=this.m_upperTranslation?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitImpulse=0)}}if(0==this.m_enableMotor&&(this.m_motorImpulse=0),0==this.m_enableLimit&&(this.m_limitImpulse=0),b2World.s_enableWarmStarting){var g=this.m_linearImpulse*this.m_linearJacobian.linear1.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.x,I=this.m_linearImpulse*this.m_linearJacobian.linear1.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.y,M=this.m_linearImpulse*this.m_linearJacobian.linear2.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.x,V=this.m_linearImpulse*this.m_linearJacobian.linear2.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.y,S=this.m_linearImpulse*this.m_linearJacobian.angular1-this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular1,v=this.m_linearImpulse*this.m_linearJacobian.angular2+this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular2;t.m_linearVelocity.x+=s*g,t.m_linearVelocity.y+=s*I,t.m_angularVelocity+=e*S,o.m_linearVelocity.x+=_*M,o.m_linearVelocity.y+=_*V,o.m_angularVelocity+=r*v}else this.m_linearImpulse=0,this.m_angularImpulse=0,this.m_limitImpulse=0,this.m_motorImpulse=0;this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(i){var t,o=this.m_body1,l=this.m_body2,m=o.m_invMass,a=l.m_invMass,n=o.m_invI,s=l.m_invI,_=this.m_linearJacobian.Compute(o.m_linearVelocity,o.m_angularVelocity,l.m_linearVelocity,l.m_angularVelocity),e=-this.m_linearMass*_;this.m_linearImpulse+=e,o.m_linearVelocity.x+=m*e*this.m_linearJacobian.linear1.x,o.m_linearVelocity.y+=m*e*this.m_linearJacobian.linear1.y,o.m_angularVelocity+=n*e*this.m_linearJacobian.angular1,l.m_linearVelocity.x+=a*e*this.m_linearJacobian.linear2.x,l.m_linearVelocity.y+=a*e*this.m_linearJacobian.linear2.y,l.m_angularVelocity+=s*e*this.m_linearJacobian.angular2;var r=l.m_angularVelocity-o.m_angularVelocity,c=-this.m_angularMass*r;if(this.m_angularImpulse+=c,o.m_angularVelocity-=n*c,l.m_angularVelocity+=s*c,this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var h=this.m_motorJacobian.Compute(o.m_linearVelocity,o.m_angularVelocity,l.m_linearVelocity,l.m_angularVelocity)-this.m_motorSpeed,b=-this.m_motorMass*h,y=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+b,-i.dt*this.m_maxMotorForce,i.dt*this.m_maxMotorForce),b=this.m_motorImpulse-y,o.m_linearVelocity.x+=m*b*this.m_motorJacobian.linear1.x,o.m_linearVelocity.y+=m*b*this.m_motorJacobian.linear1.y,o.m_angularVelocity+=n*b*this.m_motorJacobian.angular1,l.m_linearVelocity.x+=a*b*this.m_motorJacobian.linear2.x,l.m_linearVelocity.y+=a*b*this.m_motorJacobian.linear2.y,l.m_angularVelocity+=s*b*this.m_motorJacobian.angular2}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var x=this.m_motorJacobian.Compute(o.m_linearVelocity,o.m_angularVelocity,l.m_linearVelocity,l.m_angularVelocity),u=-this.m_motorMass*x;this.m_limitState==b2Joint.e_equalLimits?this.m_limitImpulse+=u:this.m_limitState==b2Joint.e_atLowerLimit?(t=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+u,0),u=this.m_limitImpulse-t):this.m_limitState==b2Joint.e_atUpperLimit&&(t=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+u,0),u=this.m_limitImpulse-t),o.m_linearVelocity.x+=m*u*this.m_motorJacobian.linear1.x,o.m_linearVelocity.y+=m*u*this.m_motorJacobian.linear1.y,o.m_angularVelocity+=n*u*this.m_motorJacobian.angular1,l.m_linearVelocity.x+=a*u*this.m_motorJacobian.linear2.x,l.m_linearVelocity.y+=a*u*this.m_motorJacobian.linear2.y,l.m_angularVelocity+=s*u*this.m_motorJacobian.angular2}},SolvePositionConstraints:function(){var i,t,o,l=this.m_body1,m=this.m_body2,a=l.m_invMass,n=m.m_invMass,s=l.m_invI,_=m.m_invI;o=l.m_R;var e=o.col1.x*this.m_localAnchor1.x+o.col2.x*this.m_localAnchor1.y,r=o.col1.y*this.m_localAnchor1.x+o.col2.y*this.m_localAnchor1.y;o=m.m_R;var c=o.col1.x*this.m_localAnchor2.x+o.col2.x*this.m_localAnchor2.y,h=o.col1.y*this.m_localAnchor2.x+o.col2.y*this.m_localAnchor2.y,b=l.m_position.x+e,y=l.m_position.y+r,x=m.m_position.x+c,u=m.m_position.y+h,p=x-b,A=u-y;o=l.m_R;var J=o.col1.x*this.m_localYAxis1.x+o.col2.x*this.m_localYAxis1.y,g=o.col1.y*this.m_localYAxis1.x+o.col2.y*this.m_localYAxis1.y,I=J*p+g*A;I=b2Math.b2Clamp(I,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var M=-this.m_linearMass*I;l.m_position.x+=a*M*this.m_linearJacobian.linear1.x,l.m_position.y+=a*M*this.m_linearJacobian.linear1.y,l.m_rotation+=s*M*this.m_linearJacobian.angular1,m.m_position.x+=n*M*this.m_linearJacobian.linear2.x,m.m_position.y+=n*M*this.m_linearJacobian.linear2.y,m.m_rotation+=_*M*this.m_linearJacobian.angular2;var V=b2Math.b2Abs(I),S=m.m_rotation-l.m_rotation-this.m_initialAngle;S=b2Math.b2Clamp(S,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var v=-this.m_angularMass*S;l.m_rotation-=l.m_invI*v,l.m_R.Set(l.m_rotation),m.m_rotation+=m.m_invI*v,m.m_R.Set(m.m_rotation);var d=b2Math.b2Abs(S);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){o=l.m_R,e=o.col1.x*this.m_localAnchor1.x+o.col2.x*this.m_localAnchor1.y,r=o.col1.y*this.m_localAnchor1.x+o.col2.y*this.m_localAnchor1.y,o=m.m_R,c=o.col1.x*this.m_localAnchor2.x+o.col2.x*this.m_localAnchor2.y,h=o.col1.y*this.m_localAnchor2.x+o.col2.y*this.m_localAnchor2.y,b=l.m_position.x+e,y=l.m_position.y+r,x=m.m_position.x+c,u=m.m_position.y+h,p=x-b,A=u-y,o=l.m_R;var L=o.col1.x*this.m_localXAxis1.x+o.col2.x*this.m_localXAxis1.y,R=o.col1.y*this.m_localXAxis1.x+o.col2.y*this.m_localXAxis1.y,w=L*p+R*A,X=0;this.m_limitState==b2Joint.e_equalLimits?(i=b2Math.b2Clamp(w,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),X=-this.m_motorMass*i,V=b2Math.b2Max(V,b2Math.b2Abs(S))):this.m_limitState==b2Joint.e_atLowerLimit?(i=w-this.m_lowerTranslation,V=b2Math.b2Max(V,-i),i=b2Math.b2Clamp(i+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),X=-this.m_motorMass*i,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+X,0),X=this.m_limitPositionImpulse-t):this.m_limitState==b2Joint.e_atUpperLimit&&(i=w-this.m_upperTranslation,V=b2Math.b2Max(V,i),i=b2Math.b2Clamp(i-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),X=-this.m_motorMass*i,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+X,0),X=this.m_limitPositionImpulse-t),l.m_position.x+=a*X*this.m_motorJacobian.linear1.x,l.m_position.y+=a*X*this.m_motorJacobian.linear1.y,l.m_rotation+=s*X*this.m_motorJacobian.angular1,l.m_R.Set(l.m_rotation),m.m_position.x+=n*X*this.m_motorJacobian.linear2.x,m.m_position.y+=n*X*this.m_motorJacobian.linear2.y,m.m_rotation+=_*X*this.m_motorJacobian.angular2,m.m_R.Set(m.m_rotation)}return V<=b2Settings.b2_linearSlop&&d<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_localXAxis1:new b2Vec2,m_localYAxis1:new b2Vec2,m_initialAngle:null,m_linearJacobian:new b2Jacobian,m_linearMass:null,m_linearImpulse:null,m_angularMass:null,m_angularImpulse:null,m_motorJacobian:new b2Jacobian,m_motorMass:null,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_lowerTranslation:null,m_upperTranslation:null,m_maxMotorForce:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0});