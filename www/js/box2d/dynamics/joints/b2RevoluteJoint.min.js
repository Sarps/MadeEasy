var b2RevoluteJoint=Class.create();Object.extend(b2RevoluteJoint.prototype,b2Joint.prototype),Object.extend(b2RevoluteJoint.prototype,{GetAnchor1:function(){var t=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var t=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y))},GetJointAngle:function(){return this.m_body2.m_rotation-this.m_body1.m_rotation},GetJointSpeed:function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity},GetMotorTorque:function(t){return t*this.m_motorImpulse},SetMotorSpeed:function(t){this.m_motorSpeed=t},SetMotorTorque:function(t){this.m_maxMotorTorque=t},GetReactionForce:function(t){var i=this.m_ptpImpulse.Copy();return i.Multiply(t),i},GetReactionTorque:function(t){return t*this.m_limitImpulse},initialize:function(t){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_ptpImpulse=new b2Vec2,this.m_ptpMass=new b2Mat22;var i,o,m;i=this.m_body1.m_R,o=t.anchorPoint.x-this.m_body1.m_position.x,m=t.anchorPoint.y-this.m_body1.m_position.y,this.m_localAnchor1.x=o*i.col1.x+m*i.col1.y,this.m_localAnchor1.y=o*i.col2.x+m*i.col2.y,i=this.m_body2.m_R,o=t.anchorPoint.x-this.m_body2.m_position.x,m=t.anchorPoint.y-this.m_body2.m_position.y,this.m_localAnchor2.x=o*i.col1.x+m*i.col1.y,this.m_localAnchor2.y=o*i.col2.x+m*i.col2.y,this.m_intialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation,this.m_ptpImpulse.Set(0,0),this.m_motorImpulse=0,this.m_limitImpulse=0,this.m_limitPositionImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.motorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,K3:new b2Mat22,PrepareVelocitySolver:function(){var t,i=this.m_body1,o=this.m_body2;t=i.m_R;var m=t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,l=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y;t=o.m_R;var s=t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,e=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,n=i.m_invMass,_=o.m_invMass,h=i.m_invI,a=o.m_invI;if(this.K1.col1.x=n+_,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=n+_,this.K2.col1.x=h*l*l,this.K2.col2.x=-h*m*l,this.K2.col1.y=-h*m*l,this.K2.col2.y=h*m*m,this.K3.col1.x=a*e*e,this.K3.col2.x=-a*s*e,this.K3.col1.y=-a*s*e,this.K3.col2.y=a*s*s,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Invert(this.m_ptpMass),this.m_motorMass=1/(h+a),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var r=o.m_rotation-i.m_rotation-this.m_intialAngle;b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:r<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atLowerLimit):r>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitImpulse=0)}else this.m_limitImpulse=0;b2World.s_enableWarmStarting?(i.m_linearVelocity.x-=n*this.m_ptpImpulse.x,i.m_linearVelocity.y-=n*this.m_ptpImpulse.y,i.m_angularVelocity-=h*(m*this.m_ptpImpulse.y-l*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse),o.m_linearVelocity.x+=_*this.m_ptpImpulse.x,o.m_linearVelocity.y+=_*this.m_ptpImpulse.y,o.m_angularVelocity+=a*(s*this.m_ptpImpulse.y-e*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse)):(this.m_ptpImpulse.SetZero(),this.m_motorImpulse=0,this.m_limitImpulse=0),this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(t){var i,o=this.m_body1,m=this.m_body2;i=o.m_R;var l=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,s=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=m.m_R;var e,n=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,_=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,h=m.m_linearVelocity.x+-m.m_angularVelocity*_-o.m_linearVelocity.x- -o.m_angularVelocity*s,a=m.m_linearVelocity.y+m.m_angularVelocity*n-o.m_linearVelocity.y-o.m_angularVelocity*l,r=-(this.m_ptpMass.col1.x*h+this.m_ptpMass.col2.x*a),c=-(this.m_ptpMass.col1.y*h+this.m_ptpMass.col2.y*a);if(this.m_ptpImpulse.x+=r,this.m_ptpImpulse.y+=c,o.m_linearVelocity.x-=o.m_invMass*r,o.m_linearVelocity.y-=o.m_invMass*c,o.m_angularVelocity-=o.m_invI*(l*c-s*r),m.m_linearVelocity.x+=m.m_invMass*r,m.m_linearVelocity.y+=m.m_invMass*c,m.m_angularVelocity+=m.m_invI*(n*c-_*r),this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var p=m.m_angularVelocity-o.m_angularVelocity-this.m_motorSpeed,u=-this.m_motorMass*p,y=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+u,-t.dt*this.m_maxMotorTorque,t.dt*this.m_maxMotorTorque),u=this.m_motorImpulse-y,o.m_angularVelocity-=o.m_invI*u,m.m_angularVelocity+=m.m_invI*u}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var b=m.m_angularVelocity-o.m_angularVelocity,x=-this.m_motorMass*b;this.m_limitState==b2Joint.e_equalLimits?this.m_limitImpulse+=x:this.m_limitState==b2Joint.e_atLowerLimit?(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+x,0),x=this.m_limitImpulse-e):this.m_limitState==b2Joint.e_atUpperLimit&&(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+x,0),x=this.m_limitImpulse-e),o.m_angularVelocity-=o.m_invI*x,m.m_angularVelocity+=m.m_invI*x}},SolvePositionConstraints:function(){var t,i,o,m=this.m_body1,l=this.m_body2,s=0;o=m.m_R;var e=o.col1.x*this.m_localAnchor1.x+o.col2.x*this.m_localAnchor1.y,n=o.col1.y*this.m_localAnchor1.x+o.col2.y*this.m_localAnchor1.y;o=l.m_R;var _=o.col1.x*this.m_localAnchor2.x+o.col2.x*this.m_localAnchor2.y,h=o.col1.y*this.m_localAnchor2.x+o.col2.y*this.m_localAnchor2.y,a=m.m_position.x+e,r=m.m_position.y+n,c=l.m_position.x+_,p=l.m_position.y+h,u=c-a,y=p-r;s=Math.sqrt(u*u+y*y);var b=m.m_invMass,x=l.m_invMass,I=m.m_invI,M=l.m_invI;this.K1.col1.x=b+x,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=b+x,this.K2.col1.x=I*n*n,this.K2.col2.x=-I*e*n,this.K2.col1.y=-I*e*n,this.K2.col2.y=I*e*e,this.K3.col1.x=M*h*h,this.K3.col2.x=-M*_*h,this.K3.col1.y=-M*_*h,this.K3.col2.y=M*_*_,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-u,-y);var A=b2RevoluteJoint.tImpulse.x,v=b2RevoluteJoint.tImpulse.y;m.m_position.x-=m.m_invMass*A,m.m_position.y-=m.m_invMass*v,m.m_rotation-=m.m_invI*(e*v-n*A),m.m_R.Set(m.m_rotation),l.m_position.x+=l.m_invMass*A,l.m_position.y+=l.m_invMass*v,l.m_rotation+=l.m_invI*(_*v-h*A),l.m_R.Set(l.m_rotation);var d=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var g=l.m_rotation-m.m_rotation-this.m_intialAngle,S=0;this.m_limitState==b2Joint.e_equalLimits?(i=b2Math.b2Clamp(g,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),S=-this.m_motorMass*i,d=b2Math.b2Abs(i)):this.m_limitState==b2Joint.e_atLowerLimit?(i=g-this.m_lowerAngle,d=b2Math.b2Max(0,-i),i=b2Math.b2Clamp(i+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),S=-this.m_motorMass*i,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+S,0),S=this.m_limitPositionImpulse-t):this.m_limitState==b2Joint.e_atUpperLimit&&(i=g-this.m_upperAngle,d=b2Math.b2Max(0,i),i=b2Math.b2Clamp(i-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),S=-this.m_motorMass*i,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+S,0),S=this.m_limitPositionImpulse-t),m.m_rotation-=m.m_invI*S,m.m_R.Set(m.m_rotation),l.m_rotation+=l.m_invI*S,l.m_R.Set(l.m_rotation)}return s<=b2Settings.b2_linearSlop&&d<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_ptpImpulse:new b2Vec2,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_ptpMass:new b2Mat22,m_motorMass:null,m_intialAngle:null,m_lowerAngle:null,m_upperAngle:null,m_maxMotorTorque:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0}),b2RevoluteJoint.tImpulse=new b2Vec2;