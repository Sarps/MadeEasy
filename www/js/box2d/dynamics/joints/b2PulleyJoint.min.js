var b2PulleyJoint=Class.create();Object.extend(b2PulleyJoint.prototype,b2Joint.prototype),Object.extend(b2PulleyJoint.prototype,{GetAnchor1:function(){var i=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var i=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y))},GetGroundPoint1:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor1.x,this.m_ground.m_position.y+this.m_groundAnchor1.y)},GetGroundPoint2:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor2.x,this.m_ground.m_position.y+this.m_groundAnchor2.y)},GetReactionForce:function(){return new b2Vec2},GetReactionTorque:function(){return 0},GetLength1:function(){var i;i=this.m_body1.m_R;var t=this.m_body1.m_position.x+(i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y),o=this.m_body1.m_position.y+(i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y),m=t-(this.m_ground.m_position.x+this.m_groundAnchor1.x),s=o-(this.m_ground.m_position.y+this.m_groundAnchor1.y);return Math.sqrt(m*m+s*s)},GetLength2:function(){var i;i=this.m_body2.m_R;var t=this.m_body2.m_position.x+(i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y),o=this.m_body2.m_position.y+(i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y),m=t-(this.m_ground.m_position.x+this.m_groundAnchor2.x),s=o-(this.m_ground.m_position.y+this.m_groundAnchor2.y);return Math.sqrt(m*m+s*s)},GetRatio:function(){return this.m_ratio},initialize:function(i){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=i.type,this.m_prev=null,this.m_next=null,this.m_body1=i.body1,this.m_body2=i.body2,this.m_collideConnected=i.collideConnected,this.m_islandFlag=!1,this.m_userData=i.userData,this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2;var t,o,m;this.m_ground=this.m_body1.m_world.m_groundBody,this.m_groundAnchor1.x=i.groundPoint1.x-this.m_ground.m_position.x,this.m_groundAnchor1.y=i.groundPoint1.y-this.m_ground.m_position.y,this.m_groundAnchor2.x=i.groundPoint2.x-this.m_ground.m_position.x,this.m_groundAnchor2.y=i.groundPoint2.y-this.m_ground.m_position.y,t=this.m_body1.m_R,o=i.anchorPoint1.x-this.m_body1.m_position.x,m=i.anchorPoint1.y-this.m_body1.m_position.y,this.m_localAnchor1.x=o*t.col1.x+m*t.col1.y,this.m_localAnchor1.y=o*t.col2.x+m*t.col2.y,t=this.m_body2.m_R,o=i.anchorPoint2.x-this.m_body2.m_position.x,m=i.anchorPoint2.y-this.m_body2.m_position.y,this.m_localAnchor2.x=o*t.col1.x+m*t.col1.y,this.m_localAnchor2.y=o*t.col2.x+m*t.col2.y,this.m_ratio=i.ratio,o=i.groundPoint1.x-i.anchorPoint1.x,m=i.groundPoint1.y-i.anchorPoint1.y;var s=Math.sqrt(o*o+m*m);o=i.groundPoint2.x-i.anchorPoint2.x,m=i.groundPoint2.y-i.anchorPoint2.y;var n=Math.sqrt(o*o+m*m),_=b2Math.b2Max(.5*b2PulleyJoint.b2_minPulleyLength,s),l=b2Math.b2Max(.5*b2PulleyJoint.b2_minPulleyLength,n);this.m_constant=_+this.m_ratio*l,this.m_maxLength1=b2Math.b2Clamp(i.maxLength1,_,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=b2Math.b2Clamp(i.maxLength2,l,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_pulleyImpulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},PrepareVelocitySolver:function(){var i,t=this.m_body1,o=this.m_body2;i=t.m_R;var m=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,s=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=o.m_R;var n=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,_=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,l=t.m_position.x+m,h=t.m_position.y+s,e=o.m_position.x+n,r=o.m_position.y+_,a=this.m_ground.m_position.x+this.m_groundAnchor1.x,c=this.m_ground.m_position.y+this.m_groundAnchor1.y,u=this.m_ground.m_position.x+this.m_groundAnchor2.x,y=this.m_ground.m_position.y+this.m_groundAnchor2.y;this.m_u1.Set(l-a,h-c),this.m_u2.Set(e-u,r-y);var x=this.m_u1.Length(),p=this.m_u2.Length();x>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/x):this.m_u1.SetZero(),p>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/p):this.m_u2.SetZero(),x<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):(this.m_limitState1=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse1=0),p<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):(this.m_limitState2=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse2=0);var b=m*this.m_u1.y-s*this.m_u1.x,g=n*this.m_u2.y-_*this.m_u2.x;this.m_limitMass1=t.m_invMass+t.m_invI*b*b,this.m_limitMass2=o.m_invMass+o.m_invI*g*g,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass;var d=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.x,A=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.y,M=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.x,v=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.y;t.m_linearVelocity.x+=t.m_invMass*d,t.m_linearVelocity.y+=t.m_invMass*A,t.m_angularVelocity+=t.m_invI*(m*A-s*d),o.m_linearVelocity.x+=o.m_invMass*M,o.m_linearVelocity.y+=o.m_invMass*v,o.m_angularVelocity+=o.m_invI*(n*v-_*M)},SolveVelocityConstraints:function(){var i,t=this.m_body1,o=this.m_body2;i=t.m_R;var m=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,s=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y;i=o.m_R;var n,_,l,h,e,r,a,c,u,y,x,p=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,b=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y;n=t.m_linearVelocity.x+-t.m_angularVelocity*s,_=t.m_linearVelocity.y+t.m_angularVelocity*m,l=o.m_linearVelocity.x+-o.m_angularVelocity*b,h=o.m_linearVelocity.y+o.m_angularVelocity*p,u=-(this.m_u1.x*n+this.m_u1.y*_)-this.m_ratio*(this.m_u2.x*l+this.m_u2.y*h),y=-this.m_pulleyMass*u,this.m_pulleyImpulse+=y,e=-y*this.m_u1.x,r=-y*this.m_u1.y,a=-this.m_ratio*y*this.m_u2.x,c=-this.m_ratio*y*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*e,t.m_linearVelocity.y+=t.m_invMass*r,t.m_angularVelocity+=t.m_invI*(m*r-s*e),o.m_linearVelocity.x+=o.m_invMass*a,o.m_linearVelocity.y+=o.m_invMass*c,o.m_angularVelocity+=o.m_invI*(p*c-b*a),this.m_limitState1==b2Joint.e_atUpperLimit&&(n=t.m_linearVelocity.x+-t.m_angularVelocity*s,_=t.m_linearVelocity.y+t.m_angularVelocity*m,u=-(this.m_u1.x*n+this.m_u1.y*_),y=-this.m_limitMass1*u,x=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.b2Max(0,this.m_limitImpulse1+y),y=this.m_limitImpulse1-x,e=-y*this.m_u1.x,r=-y*this.m_u1.y,t.m_linearVelocity.x+=t.m_invMass*e,t.m_linearVelocity.y+=t.m_invMass*r,t.m_angularVelocity+=t.m_invI*(m*r-s*e)),this.m_limitState2==b2Joint.e_atUpperLimit&&(l=o.m_linearVelocity.x+-o.m_angularVelocity*b,h=o.m_linearVelocity.y+o.m_angularVelocity*p,u=-(this.m_u2.x*l+this.m_u2.y*h),y=-this.m_limitMass2*u,x=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.b2Max(0,this.m_limitImpulse2+y),y=this.m_limitImpulse2-x,a=-y*this.m_u2.x,c=-y*this.m_u2.y,o.m_linearVelocity.x+=o.m_invMass*a,o.m_linearVelocity.y+=o.m_invMass*c,o.m_angularVelocity+=o.m_invI*(p*c-b*a))},SolvePositionConstraints:function(){var i,t,o,m,s,n,_,l,h,e,r,a,c,u,y=this.m_body1,x=this.m_body2,p=this.m_ground.m_position.x+this.m_groundAnchor1.x,b=this.m_ground.m_position.y+this.m_groundAnchor1.y,g=this.m_ground.m_position.x+this.m_groundAnchor2.x,d=this.m_ground.m_position.y+this.m_groundAnchor2.y,A=0;return i=y.m_R,t=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,o=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,i=x.m_R,m=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,s=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,n=y.m_position.x+t,_=y.m_position.y+o,l=x.m_position.x+m,h=x.m_position.y+s,this.m_u1.Set(n-p,_-b),this.m_u2.Set(l-g,h-d),e=this.m_u1.Length(),r=this.m_u2.Length(),e>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),r>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/r):this.m_u2.SetZero(),a=this.m_constant-e-this.m_ratio*r,A=b2Math.b2Max(A,Math.abs(a)),a=b2Math.b2Clamp(a,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),c=-this.m_pulleyMass*a,n=-c*this.m_u1.x,_=-c*this.m_u1.y,l=-this.m_ratio*c*this.m_u2.x,h=-this.m_ratio*c*this.m_u2.y,y.m_position.x+=y.m_invMass*n,y.m_position.y+=y.m_invMass*_,y.m_rotation+=y.m_invI*(t*_-o*n),x.m_position.x+=x.m_invMass*l,x.m_position.y+=x.m_invMass*h,x.m_rotation+=x.m_invI*(m*h-s*l),y.m_R.Set(y.m_rotation),x.m_R.Set(x.m_rotation),this.m_limitState1==b2Joint.e_atUpperLimit&&(i=y.m_R,t=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,o=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,n=y.m_position.x+t,_=y.m_position.y+o,this.m_u1.Set(n-p,_-b),e=this.m_u1.Length(),e>b2Settings.b2_linearSlop?(this.m_u1.x*=1/e,this.m_u1.y*=1/e):this.m_u1.SetZero(),a=this.m_maxLength1-e,A=b2Math.b2Max(A,-a),a=b2Math.b2Clamp(a+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),c=-this.m_limitMass1*a,u=this.m_limitPositionImpulse1,this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+c),c=this.m_limitPositionImpulse1-u,n=-c*this.m_u1.x,_=-c*this.m_u1.y,y.m_position.x+=y.m_invMass*n,y.m_position.y+=y.m_invMass*_,y.m_rotation+=y.m_invI*(t*_-o*n),y.m_R.Set(y.m_rotation)),this.m_limitState2==b2Joint.e_atUpperLimit&&(i=x.m_R,m=i.col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,s=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,l=x.m_position.x+m,h=x.m_position.y+s,this.m_u2.Set(l-g,h-d),r=this.m_u2.Length(),r>b2Settings.b2_linearSlop?(this.m_u2.x*=1/r,this.m_u2.y*=1/r):this.m_u2.SetZero(),a=this.m_maxLength2-r,A=b2Math.b2Max(A,-a),a=b2Math.b2Clamp(a+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),c=-this.m_limitMass2*a,u=this.m_limitPositionImpulse2,this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+c),c=this.m_limitPositionImpulse2-u,l=-c*this.m_u2.x,h=-c*this.m_u2.y,x.m_position.x+=x.m_invMass*l,x.m_position.y+=x.m_invMass*h,x.m_rotation+=x.m_invI*(m*h-s*l),x.m_R.Set(x.m_rotation)),A<b2Settings.b2_linearSlop},m_ground:null,m_groundAnchor1:new b2Vec2,m_groundAnchor2:new b2Vec2,m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_u1:new b2Vec2,m_u2:new b2Vec2,m_constant:null,m_ratio:null,m_maxLength1:null,m_maxLength2:null,m_pulleyMass:null,m_limitMass1:null,m_limitMass2:null,m_pulleyImpulse:null,m_limitImpulse1:null,m_limitImpulse2:null,m_limitPositionImpulse1:null,m_limitPositionImpulse2:null,m_limitState1:0,m_limitState2:0}),b2PulleyJoint.b2_minPulleyLength=b2Settings.b2_lengthUnitsPerMeter;