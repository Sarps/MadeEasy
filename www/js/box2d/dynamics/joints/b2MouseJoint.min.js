var b2MouseJoint=Class.create();Object.extend(b2MouseJoint.prototype,b2Joint.prototype),Object.extend(b2MouseJoint.prototype,{GetAnchor1:function(){return this.m_target},GetAnchor2:function(){var t=b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor);return t.Add(this.m_body2.m_position),t},GetReactionForce:function(t){var i=new b2Vec2;return i.SetV(this.m_impulse),i.Multiply(t),i},GetReactionTorque:function(){return 0},SetTarget:function(t){this.m_body2.WakeUp(),this.m_target=t},initialize:function(t){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_ptpMass=new b2Mat22,this.m_C=new b2Vec2,this.m_target.SetV(t.target);var i=this.m_target.x-this.m_body2.m_position.x,m=this.m_target.y-this.m_body2.m_position.y;this.m_localAnchor.x=i*this.m_body2.m_R.col1.x+m*this.m_body2.m_R.col1.y,this.m_localAnchor.y=i*this.m_body2.m_R.col2.x+m*this.m_body2.m_R.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero();var e=this.m_body2.m_mass,s=2*b2Settings.b2_pi*t.frequencyHz,o=2*e*t.dampingRatio*s,l=e*s*s;this.m_gamma=1/(o+t.timeStep*l),this.m_beta=t.timeStep*l/(o+t.timeStep*l)},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,PrepareVelocitySolver:function(){var t,i=this.m_body2;t=i.m_R;var m=t.col1.x*this.m_localAnchor.x+t.col2.x*this.m_localAnchor.y,e=t.col1.y*this.m_localAnchor.x+t.col2.y*this.m_localAnchor.y,s=i.m_invMass,o=i.m_invI;this.K1.col1.x=s,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=s,this.K2.col1.x=o*e*e,this.K2.col2.x=-o*m*e,this.K2.col1.y=-o*m*e,this.K2.col2.y=o*m*m,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.Invert(this.m_ptpMass),this.m_C.x=i.m_position.x+m-this.m_target.x,this.m_C.y=i.m_position.y+e-this.m_target.y,i.m_angularVelocity*=.98;var l=this.m_impulse.x,_=this.m_impulse.y;i.m_linearVelocity.x+=s*l,i.m_linearVelocity.y+=s*_,i.m_angularVelocity+=o*(m*_-e*l)},SolveVelocityConstraints:function(t){var i,m=this.m_body2;i=m.m_R;var e=i.col1.x*this.m_localAnchor.x+i.col2.x*this.m_localAnchor.y,s=i.col1.y*this.m_localAnchor.x+i.col2.y*this.m_localAnchor.y,o=m.m_linearVelocity.x+-m.m_angularVelocity*s,l=m.m_linearVelocity.y+m.m_angularVelocity*e;i=this.m_ptpMass;var _=o+this.m_beta*t.inv_dt*this.m_C.x+this.m_gamma*this.m_impulse.x,n=l+this.m_beta*t.inv_dt*this.m_C.y+this.m_gamma*this.m_impulse.y,h=-(i.col1.x*_+i.col2.x*n),a=-(i.col1.y*_+i.col2.y*n),c=this.m_impulse.x,r=this.m_impulse.y;this.m_impulse.x+=h,this.m_impulse.y+=a;var y=this.m_impulse.Length();y>t.dt*this.m_maxForce&&this.m_impulse.Multiply(t.dt*this.m_maxForce/y),h=this.m_impulse.x-c,a=this.m_impulse.y-r,m.m_linearVelocity.x+=m.m_invMass*h,m.m_linearVelocity.y+=m.m_invMass*a,m.m_angularVelocity+=m.m_invI*(e*a-s*h)},SolvePositionConstraints:function(){return!0},m_localAnchor:new b2Vec2,m_target:new b2Vec2,m_impulse:new b2Vec2,m_ptpMass:new b2Mat22,m_C:new b2Vec2,m_maxForce:null,m_beta:null,m_gamma:null});