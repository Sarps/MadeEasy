var b2Island=Class.create();b2Island.prototype={initialize:function(t,o,i,n){var e=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=o,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodies=new Array(t),e=0;t>e;e++)this.m_bodies[e]=null;for(this.m_contacts=new Array(o),e=0;o>e;e++)this.m_contacts[e]=null;for(this.m_joints=new Array(i),e=0;i>e;e++)this.m_joints[e]=null;this.m_allocator=n},Clear:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},Solve:function(t,o){var i,n=0;for(n=0;n<this.m_bodyCount;++n)i=this.m_bodies[n],0!=i.m_invMass&&(i.m_linearVelocity.Add(b2Math.MulFV(t.dt,b2Math.AddVV(o,b2Math.MulFV(i.m_invMass,i.m_force)))),i.m_angularVelocity+=t.dt*i.m_invI*i.m_torque,i.m_linearVelocity.Multiply(i.m_linearDamping),i.m_angularVelocity*=i.m_angularDamping,i.m_position0.SetV(i.m_position),i.m_rotation0=i.m_rotation);var e=new b2ContactSolver(this.m_contacts,this.m_contactCount,this.m_allocator);for(e.PreSolve(),n=0;n<this.m_jointCount;++n)this.m_joints[n].PrepareVelocitySolver();for(n=0;n<t.iterations;++n){e.SolveVelocityConstraints();for(var a=0;a<this.m_jointCount;++a)this.m_joints[a].SolveVelocityConstraints(t)}for(n=0;n<this.m_bodyCount;++n)i=this.m_bodies[n],0!=i.m_invMass&&(i.m_position.x+=t.dt*i.m_linearVelocity.x,i.m_position.y+=t.dt*i.m_linearVelocity.y,i.m_rotation+=t.dt*i.m_angularVelocity,i.m_R.Set(i.m_rotation));for(n=0;n<this.m_jointCount;++n)this.m_joints[n].PreparePositionSolver();if(b2World.s_enablePositionCorrection)for(b2Island.m_positionIterationCount=0;b2Island.m_positionIterationCount<t.iterations;++b2Island.m_positionIterationCount){var s=e.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),_=!0;for(n=0;n<this.m_jointCount;++n){var m=this.m_joints[n].SolvePositionConstraints();_=_&&m}if(s&&_)break}for(e.PostSolve(),n=0;n<this.m_bodyCount;++n)i=this.m_bodies[n],0!=i.m_invMass&&(i.m_R.Set(i.m_rotation),i.SynchronizeShapes(),i.m_force.Set(0,0),i.m_torque=0)},UpdateSleep:function(t){var o,i=0,n=Number.MAX_VALUE,e=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,a=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],0!=o.m_invMass&&(0==(o.m_flags&b2Body.e_allowSleepFlag)&&(o.m_sleepTime=0,n=0),0==(o.m_flags&b2Body.e_allowSleepFlag)||o.m_angularVelocity*o.m_angularVelocity>a||b2Math.b2Dot(o.m_linearVelocity,o.m_linearVelocity)>e?(o.m_sleepTime=0,n=0):(o.m_sleepTime+=t,n=b2Math.b2Min(n,o.m_sleepTime)));if(n>=b2Settings.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.m_flags|=b2Body.e_sleepFlag},AddBody:function(t){this.m_bodies[this.m_bodyCount++]=t},AddContact:function(t){this.m_contacts[this.m_contactCount++]=t},AddJoint:function(t){this.m_joints[this.m_jointCount++]=t},m_allocator:null,m_bodies:null,m_contacts:null,m_joints:null,m_bodyCount:0,m_jointCount:0,m_contactCount:0,m_bodyCapacity:0,m_contactCapacity:0,m_jointCapacity:0,m_positionError:null},b2Island.m_positionIterationCount=0;