var b2World=Class.create();b2World.prototype={initialize:function(t,o,n){this.step=new b2TimeStep,this.m_contactManager=new b2ContactManager,this.m_listener=null,this.m_filter=b2CollisionFilter.b2_defaultFilter,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodyDestroyList=null,this.m_allowSleep=n,this.m_gravity=o,this.m_contactManager.m_world=this,this.m_broadPhase=new b2BroadPhase(t,this.m_contactManager);var e=new b2BodyDef;this.m_groundBody=this.CreateBody(e)},SetListener:function(t){this.m_listener=t},SetFilter:function(t){this.m_filter=t},CreateBody:function(t){var o=new b2Body(t,this);return o.m_prev=null,o.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=o),this.m_bodyList=o,++this.m_bodyCount,o},DestroyBody:function(t){t.m_flags&b2Body.e_destroyFlag||(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_flags|=b2Body.e_destroyFlag,--this.m_bodyCount,t.m_prev=null,t.m_next=this.m_bodyDestroyList,this.m_bodyDestroyList=t)},CleanBodyList:function(){this.m_contactManager.m_destroyImmediate=!0;for(var t=this.m_bodyDestroyList;t;){var o=t;t=t.m_next;for(var n=o.m_jointList;n;){var e=n;n=n.next,this.m_listener&&this.m_listener.NotifyJointDestroyed(e.joint),this.DestroyJoint(e.joint)}o.Destroy()}this.m_bodyDestroyList=null,this.m_contactManager.m_destroyImmediate=!1},CreateJoint:function(t){var o=b2Joint.Create(t,this.m_blockAllocator);if(o.m_prev=null,o.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=o),this.m_jointList=o,++this.m_jointCount,o.m_node1.joint=o,o.m_node1.other=o.m_body2,o.m_node1.prev=null,o.m_node1.next=o.m_body1.m_jointList,o.m_body1.m_jointList&&(o.m_body1.m_jointList.prev=o.m_node1),o.m_body1.m_jointList=o.m_node1,o.m_node2.joint=o,o.m_node2.other=o.m_body1,o.m_node2.prev=null,o.m_node2.next=o.m_body2.m_jointList,o.m_body2.m_jointList&&(o.m_body2.m_jointList.prev=o.m_node2),o.m_body2.m_jointList=o.m_node2,0==t.collideConnected)for(var n=t.body1.m_shapeCount<t.body2.m_shapeCount?t.body1:t.body2,e=n.m_shapeList;e;e=e.m_next)e.ResetProxy(this.m_broadPhase);return o},DestroyJoint:function(t){var o=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var n=t.m_body1,e=t.m_body2;if(n.WakeUp(),e.WakeUp(),t.m_node1.prev&&(t.m_node1.prev.next=t.m_node1.next),t.m_node1.next&&(t.m_node1.next.prev=t.m_node1.prev),t.m_node1==n.m_jointList&&(n.m_jointList=t.m_node1.next),t.m_node1.prev=null,t.m_node1.next=null,t.m_node2.prev&&(t.m_node2.prev.next=t.m_node2.next),t.m_node2.next&&(t.m_node2.next.prev=t.m_node2.prev),t.m_node2==e.m_jointList&&(e.m_jointList=t.m_node2.next),t.m_node2.prev=null,t.m_node2.next=null,b2Joint.Destroy(t,this.m_blockAllocator),--this.m_jointCount,0==o)for(var i=n.m_shapeCount<e.m_shapeCount?n:e,s=i.m_shapeList;s;s=s.m_next)s.ResetProxy(this.m_broadPhase)},GetGroundBody:function(){return this.m_groundBody},step:new b2TimeStep,Step:function(t,o){var n,e;this.step.dt=t,this.step.iterations=o,this.step.inv_dt=t>0?1/t:0,this.m_positionIterationCount=0,this.m_contactManager.CleanContactList(),this.CleanBodyList(),this.m_contactManager.Collide();var i=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator);for(n=this.m_bodyList;null!=n;n=n.m_next)n.m_flags&=~b2Body.e_islandFlag;for(var s=this.m_contactList;null!=s;s=s.m_next)s.m_flags&=~b2Contact.e_islandFlag;for(var _=this.m_jointList;null!=_;_=_.m_next)_.m_islandFlag=!1;for(var m=(this.m_bodyCount,new Array(this.m_bodyCount)),a=0;a<this.m_bodyCount;a++)m[a]=null;for(var l=this.m_bodyList;null!=l;l=l.m_next)if(!(l.m_flags&(b2Body.e_staticFlag|b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag))){i.Clear();var r=0;for(m[r++]=l,l.m_flags|=b2Body.e_islandFlag;r>0;)if(n=m[--r],i.AddBody(n),n.m_flags&=~b2Body.e_sleepFlag,!(n.m_flags&b2Body.e_staticFlag)){for(var d=n.m_contactList;null!=d;d=d.next)d.contact.m_flags&b2Contact.e_islandFlag||(i.AddContact(d.contact),d.contact.m_flags|=b2Contact.e_islandFlag,e=d.other,e.m_flags&b2Body.e_islandFlag||(m[r++]=e,e.m_flags|=b2Body.e_islandFlag));for(var y=n.m_jointList;null!=y;y=y.next)1!=y.joint.m_islandFlag&&(i.AddJoint(y.joint),y.joint.m_islandFlag=!0,e=y.other,e.m_flags&b2Body.e_islandFlag||(m[r++]=e,e.m_flags|=b2Body.e_islandFlag))}i.Solve(this.step,this.m_gravity),this.m_positionIterationCount=b2Math.b2Max(this.m_positionIterationCount,b2Island.m_positionIterationCount),this.m_allowSleep&&i.UpdateSleep(t);for(var h=0;h<i.m_bodyCount;++h)if(n=i.m_bodies[h],n.m_flags&b2Body.e_staticFlag&&(n.m_flags&=~b2Body.e_islandFlag),n.IsFrozen()&&this.m_listener){var b=this.m_listener.NotifyBoundaryViolated(n);b==b2WorldListener.b2_destroyBody&&(this.DestroyBody(n),n=null,i.m_bodies[h]=null)}}this.m_broadPhase.Commit()},Query:function(t,o,n){for(var e=new Array,i=this.m_broadPhase.QueryAABB(t,e,n),s=0;i>s;++s)o[s]=e[s];return i},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},m_blockAllocator:null,m_stackAllocator:null,m_broadPhase:null,m_contactManager:new b2ContactManager,m_bodyList:null,m_contactList:null,m_jointList:null,m_bodyCount:0,m_contactCount:0,m_jointCount:0,m_bodyDestroyList:null,m_gravity:null,m_allowSleep:null,m_groundBody:null,m_listener:null,m_filter:null,m_positionIterationCount:0},b2World.s_enablePositionCorrection=1,b2World.s_enableWarmStarting=1;