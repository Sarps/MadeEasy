var b2PolyShape=Class.create();Object.extend(b2PolyShape.prototype,b2Shape.prototype),Object.extend(b2PolyShape.prototype,{TestPoint:function(t){var e=new b2Vec2;e.SetV(t),e.Subtract(this.m_position),e.MulTM(this.m_R);for(var i=0;i<this.m_vertexCount;++i){var o=new b2Vec2;o.SetV(e),o.Subtract(this.m_vertices[i]);var s=b2Math.b2Dot(this.m_normals[i],o);if(s>0)return!1}return!0},initialize:function(t,e,i){this.m_R=new b2Mat22,this.m_position=new b2Vec2,this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=e,this.m_proxyId=b2Pair.b2_nullProxy,this.m_maxRadius=0,this.m_categoryBits=t.categoryBits,this.m_maskBits=t.maskBits,this.m_groupIndex=t.groupIndex,this.syncAABB=new b2AABB,this.syncMat=new b2Mat22,this.m_localCentroid=new b2Vec2,this.m_localOBB=new b2OBB;var o,s,c,l=0,h=new b2AABB;this.m_vertices=new Array(b2Settings.b2_maxPolyVertices),this.m_coreVertices=new Array(b2Settings.b2_maxPolyVertices),this.m_normals=new Array(b2Settings.b2_maxPolyVertices),this.m_type=b2Shape.e_polyShape;var m=new b2Mat22(t.localRotation);if(t.type==b2Shape.e_boxShape){this.m_localCentroid.x=t.localPosition.x-i.x,this.m_localCentroid.y=t.localPosition.y-i.y;var y=t;this.m_vertexCount=4,o=y.extents.x,s=y.extents.y;var r=Math.max(0,o-2*b2Settings.b2_linearSlop),x=Math.max(0,s-2*b2Settings.b2_linearSlop);c=this.m_vertices[0]=new b2Vec2,c.x=m.col1.x*o+m.col2.x*s,c.y=m.col1.y*o+m.col2.y*s,c=this.m_vertices[1]=new b2Vec2,c.x=m.col1.x*-o+m.col2.x*s,c.y=m.col1.y*-o+m.col2.y*s,c=this.m_vertices[2]=new b2Vec2,c.x=m.col1.x*-o+m.col2.x*-s,c.y=m.col1.y*-o+m.col2.y*-s,c=this.m_vertices[3]=new b2Vec2,c.x=m.col1.x*o+m.col2.x*-s,c.y=m.col1.y*o+m.col2.y*-s,c=this.m_coreVertices[0]=new b2Vec2,c.x=m.col1.x*r+m.col2.x*x,c.y=m.col1.y*r+m.col2.y*x,c=this.m_coreVertices[1]=new b2Vec2,c.x=m.col1.x*-r+m.col2.x*x,c.y=m.col1.y*-r+m.col2.y*x,c=this.m_coreVertices[2]=new b2Vec2,c.x=m.col1.x*-r+m.col2.x*-x,c.y=m.col1.y*-r+m.col2.y*-x,c=this.m_coreVertices[3]=new b2Vec2,c.x=m.col1.x*r+m.col2.x*-x,c.y=m.col1.y*r+m.col2.y*-x}else{var a=t;this.m_vertexCount=a.vertexCount,b2Shape.PolyCentroid(a.vertices,a.vertexCount,b2PolyShape.tempVec);var n=b2PolyShape.tempVec.x,_=b2PolyShape.tempVec.y;for(this.m_localCentroid.x=t.localPosition.x+(m.col1.x*n+m.col2.x*_)-i.x,this.m_localCentroid.y=t.localPosition.y+(m.col1.y*n+m.col2.y*_)-i.y,l=0;l<this.m_vertexCount;++l){this.m_vertices[l]=new b2Vec2,this.m_coreVertices[l]=new b2Vec2,o=a.vertices[l].x-n,s=a.vertices[l].y-_,this.m_vertices[l].x=m.col1.x*o+m.col2.x*s,this.m_vertices[l].y=m.col1.y*o+m.col2.y*s;var B=this.m_vertices[l].x,b=this.m_vertices[l].y,V=Math.sqrt(B*B+b*b);V>Number.MIN_VALUE&&(B*=1/V,b*=1/V),this.m_coreVertices[l].x=this.m_vertices[l].x-2*b2Settings.b2_linearSlop*B,this.m_coreVertices[l].y=this.m_vertices[l].y-2*b2Settings.b2_linearSlop*b}}var p=Number.MAX_VALUE,A=Number.MAX_VALUE,R=-Number.MAX_VALUE,d=-Number.MAX_VALUE;for(this.m_maxRadius=0,l=0;l<this.m_vertexCount;++l){var v=this.m_vertices[l];p=Math.min(p,v.x),A=Math.min(A,v.y),R=Math.max(R,v.x),d=Math.max(d,v.y),this.m_maxRadius=Math.max(this.m_maxRadius,v.Length())}this.m_localOBB.R.SetIdentity(),this.m_localOBB.center.Set(.5*(p+R),.5*(A+d)),this.m_localOBB.extents.Set(.5*(R-p),.5*(d-A));var M=0,u=0;for(l=0;l<this.m_vertexCount;++l)this.m_normals[l]=new b2Vec2,M=l,u=l+1<this.m_vertexCount?l+1:0,this.m_normals[l].x=this.m_vertices[u].y-this.m_vertices[M].y,this.m_normals[l].y=-(this.m_vertices[u].x-this.m_vertices[M].x),this.m_normals[l].Normalize();for(l=0;l<this.m_vertexCount;++l)M=l,u=l+1<this.m_vertexCount?l+1:0;this.m_R.SetM(this.m_body.m_R),this.m_position.x=this.m_body.m_position.x+(this.m_R.col1.x*this.m_localCentroid.x+this.m_R.col2.x*this.m_localCentroid.y),this.m_position.y=this.m_body.m_position.y+(this.m_R.col1.y*this.m_localCentroid.x+this.m_R.col2.y*this.m_localCentroid.y),b2PolyShape.tAbsR.col1.x=this.m_R.col1.x*this.m_localOBB.R.col1.x+this.m_R.col2.x*this.m_localOBB.R.col1.y,b2PolyShape.tAbsR.col1.y=this.m_R.col1.y*this.m_localOBB.R.col1.x+this.m_R.col2.y*this.m_localOBB.R.col1.y,b2PolyShape.tAbsR.col2.x=this.m_R.col1.x*this.m_localOBB.R.col2.x+this.m_R.col2.x*this.m_localOBB.R.col2.y,b2PolyShape.tAbsR.col2.y=this.m_R.col1.y*this.m_localOBB.R.col2.x+this.m_R.col2.y*this.m_localOBB.R.col2.y,b2PolyShape.tAbsR.Abs(),o=b2PolyShape.tAbsR.col1.x*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.x*this.m_localOBB.extents.y,s=b2PolyShape.tAbsR.col1.y*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.y*this.m_localOBB.extents.y;var S=this.m_position.x+(this.m_R.col1.x*this.m_localOBB.center.x+this.m_R.col2.x*this.m_localOBB.center.y),P=this.m_position.y+(this.m_R.col1.y*this.m_localOBB.center.x+this.m_R.col2.y*this.m_localOBB.center.y);h.minVertex.x=S-o,h.minVertex.y=P-s,h.maxVertex.x=S+o,h.maxVertex.y=P+s;var O=this.m_body.m_world.m_broadPhase;this.m_proxyId=O.InRange(h)?O.CreateProxy(h,this):b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()},syncAABB:new b2AABB,syncMat:new b2Mat22,Synchronize:function(t,e,i,o){if(this.m_R.SetM(o),this.m_position.x=this.m_body.m_position.x+(o.col1.x*this.m_localCentroid.x+o.col2.x*this.m_localCentroid.y),this.m_position.y=this.m_body.m_position.y+(o.col1.y*this.m_localCentroid.x+o.col2.y*this.m_localCentroid.y),this.m_proxyId!=b2Pair.b2_nullProxy){var s,c,l=e.col1,h=e.col2,m=this.m_localOBB.R.col1,y=this.m_localOBB.R.col2;this.syncMat.col1.x=l.x*m.x+h.x*m.y,this.syncMat.col1.y=l.y*m.x+h.y*m.y,this.syncMat.col2.x=l.x*y.x+h.x*y.y,this.syncMat.col2.y=l.y*y.x+h.y*y.y,this.syncMat.Abs(),s=this.m_localCentroid.x+this.m_localOBB.center.x,c=this.m_localCentroid.y+this.m_localOBB.center.y;var r=t.x+(e.col1.x*s+e.col2.x*c),x=t.y+(e.col1.y*s+e.col2.y*c);s=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y,c=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y,this.syncAABB.minVertex.x=r-s,this.syncAABB.minVertex.y=x-c,this.syncAABB.maxVertex.x=r+s,this.syncAABB.maxVertex.y=x+c,l=o.col1,h=o.col2,m=this.m_localOBB.R.col1,y=this.m_localOBB.R.col2,this.syncMat.col1.x=l.x*m.x+h.x*m.y,this.syncMat.col1.y=l.y*m.x+h.y*m.y,this.syncMat.col2.x=l.x*y.x+h.x*y.y,this.syncMat.col2.y=l.y*y.x+h.y*y.y,this.syncMat.Abs(),s=this.m_localCentroid.x+this.m_localOBB.center.x,c=this.m_localCentroid.y+this.m_localOBB.center.y,r=i.x+(o.col1.x*s+o.col2.x*c),x=i.y+(o.col1.y*s+o.col2.y*c),s=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y,c=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y,this.syncAABB.minVertex.x=Math.min(this.syncAABB.minVertex.x,r-s),this.syncAABB.minVertex.y=Math.min(this.syncAABB.minVertex.y,x-c),this.syncAABB.maxVertex.x=Math.max(this.syncAABB.maxVertex.x,r+s),this.syncAABB.maxVertex.y=Math.max(this.syncAABB.maxVertex.y,x+c);var a=this.m_body.m_world.m_broadPhase;a.InRange(this.syncAABB)?a.MoveProxy(this.m_proxyId,this.syncAABB):this.m_body.Freeze()}},QuickSync:function(t,e){this.m_R.SetM(e),this.m_position.x=t.x+(e.col1.x*this.m_localCentroid.x+e.col2.x*this.m_localCentroid.y),this.m_position.y=t.y+(e.col1.y*this.m_localCentroid.x+e.col2.y*this.m_localCentroid.y)},ResetProxy:function(t){if(this.m_proxyId!=b2Pair.b2_nullProxy){var e=t.GetProxy(this.m_proxyId);t.DestroyProxy(this.m_proxyId),e=null;var i=b2Math.b2MulMM(this.m_R,this.m_localOBB.R),o=b2Math.b2AbsM(i),s=b2Math.b2MulMV(o,this.m_localOBB.extents),c=b2Math.b2MulMV(this.m_R,this.m_localOBB.center);c.Add(this.m_position);var l=new b2AABB;l.minVertex.SetV(c),l.minVertex.Subtract(s),l.maxVertex.SetV(c),l.maxVertex.Add(s),this.m_proxyId=t.InRange(l)?t.CreateProxy(l,this):b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()}},Support:function(t,e,i){for(var o=t*this.m_R.col1.x+e*this.m_R.col1.y,s=t*this.m_R.col2.x+e*this.m_R.col2.y,c=0,l=this.m_coreVertices[0].x*o+this.m_coreVertices[0].y*s,h=1;h<this.m_vertexCount;++h){var m=this.m_coreVertices[h].x*o+this.m_coreVertices[h].y*s;m>l&&(c=h,l=m)}i.Set(this.m_position.x+(this.m_R.col1.x*this.m_coreVertices[c].x+this.m_R.col2.x*this.m_coreVertices[c].y),this.m_position.y+(this.m_R.col1.y*this.m_coreVertices[c].x+this.m_R.col2.y*this.m_coreVertices[c].y))},m_localCentroid:new b2Vec2,m_localOBB:new b2OBB,m_vertices:null,m_coreVertices:null,m_vertexCount:0,m_normals:null}),b2PolyShape.tempVec=new b2Vec2,b2PolyShape.tAbsR=new b2Mat22;